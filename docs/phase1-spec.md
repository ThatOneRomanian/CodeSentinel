# CodeSentinel – Phase 1 Technical Specification (CLI MVP)

© 2025 Andrei Antonescu. All rights reserved.
Proprietary – not licensed for public redistribution.

## 1. Overview

Phase 1 defines the foundational, local-first, zero-cloud, Python-based security scanner for CodeSentinel.

The goal of this phase is to deliver:

A reliable CLI tool

Capable of scanning a directory

Detecting secrets & insecure configurations

Producing structured reports

Running offline

Following a clean modular architecture

This MVP forms the base that Phase 2+ will extend.

## 2. Core Objectives

Implement the file scanning engine

Implement the rule-based detection system

Implement the reporting layer

Implement the CLI interface

Produce Markdown + JSON results

Ensure high performance + local-only compatibility

Establish a clean, extensible project architecture

## 3. CLI Requirements
### 3.1 Usage
codesentinel scan <target_path>

### 3.2 Flags
Flag	Description
`--format json	md
--exclude <pattern>	Glob/regex exclusions
--show-entropy	Display entropy scores
--exit-on-findings	Exit 1 when issues detected
--ci	CI mode → JSON only, no color, strict exit codes
--verbose	Detailed logging

### 3.3 Exit Codes
Code	Meaning
0	No issues
1	Issues found
2	Runtime error
3	Invalid arguments

## 4. Project Structure

Finalized layout for CodeSentinel:

/codesentinel
    /src
        /sentinel
            /cli
                main.py
            /scanner
                walker.py
                engine.py
            /rules
                secrets.py
                configs.py
            /reporting
                markdown.py
                json_report.py
            /utils
                entropy.py
                patterns.py
    /tests
        /unit
        /integration
    /docs
    /memory-bank
    pyproject.toml
    README.md


This layout must not be altered unless documented in the memory bank & decision log.

## 5. Components & Responsibilities
### 5.1 File Walker (walker.py)

Responsible for:

Recursively scanning directories

Respecting .gitignore-like exclusions

Skipping binary files

Enforcing size limits

Returning normalized file lists

### 5.2 Rule Engine (engine.py)

Responsibilities:

Dynamically load all rules from /rules directory

Execute each rule on text files

Return normalized finding objects:

{
  "rule_id": "SECRET_API_KEY",
  "file_path": "src/app.py",
  "line": 42,
  "severity": "high",
  "excerpt": "apikey = '123...'",
  "confidence": 0.92
}

### 5.3 Rule Modules
#### 5.3.1 Secret Rules (secrets.py)

Must detect:

AWS Access Keys

GCP tokens

Azure secrets

Stripe keys

JWTs / signing secrets

OAuth tokens

Private keys (BEGIN RSA PRIVATE KEY)

Hardcoded passwords

High-entropy strings

API keys in env files

#### 5.3.2 Config Vulnerability Rules (configs.py)

Must detect:

DEBUG=True (Flask/Django)

Bind to 0.0.0.0

Weak crypto (md5, sha1)

Default credentials

Missing environment variable usage

Unsecured TLS flags

Insecure config literals

## 6. Output Format Requirements
### 6.1 Markdown Report

Generated by markdown.py.

Sections:

Summary

List of findings grouped by severity

Per-file breakdown

Excerpts

Recommendations

### 6.2 JSON Report

Generated by json_report.py.

Format:

[
  {
    "rule_id": "...",
    "severity": "...",
    "file_path": "...",
    "line": 0,
    "excerpt": "...",
    "confidence": 0.0
  }
]

Optional:

Timestamp

Scan duration

Version number

## 7. Performance Requirements

Must handle 10,000+ files in under 3 seconds on SSD

Entropy calculation must be O(n)

Rule engine must run in under 50ms per file on average

Memory footprint must stay low (no loading entire repo into memory)

## 8. Testing Requirements

Minimum 30% unit test coverage for Phase 1

Integration tests:

sample repo with known secrets

sample repo with insecure configs

Mock all I/O during unit tests

No external API calls allowed

## 9. Acceptance Criteria

✔ Scans directories recursively
✔ Detects all core secret/config rules
✔ Runs offline
✔ Produces MD + JSON output
✔ Supports CI mode
✔ Respect .gitignore-style exclusions
✔ Skips binary files
✔ Clean project structure created
✔ Code style adheres to systemPatterns.md
✔ Exit codes follow spec
✔ Test coverage meets minimum requirement

## 10. Deliverables for Phase 1

Fully functioning CLI MVP

Rule engine + rule set

Markdown + JSON reporters

Walker + engine

Tests for core logic

Updated memory bank files

Updated documentation

END OF FILE